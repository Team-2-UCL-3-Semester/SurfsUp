@page "/weather"
@using Newtonsoft.Json
@inject HttpClient Http

<PageTitle>Weather forecast</PageTitle>

<h1>Weather forecast</h1>

<p>This component demonstrates fetching data from the server.</p>

<input type="text" placeholder="city" @bind-value="searchCity" />
<input type="text" placeholder="StartDate" @bind-value="startDate"  />
<input type="text" placeholder="EndDate" @bind-value="endDate" />
<button @onclick="SearchCity">Search</button>
@if (forecasts == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Windspeed</th>
                <th>UV index</th>
                <th>Temperature</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var forecasts in forecasts.days)
            {
                <tr>
                    <td>@(new DateTime().AddYears(1969).AddSeconds(forecasts.datetimeEpoch))</td>
                    <td>@forecasts.windspeed</td>
                    <td>@forecasts.uvindex</td>
                    <td>@Math.Round(forecasts.feelslike)</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {





    private SRoot forecasts;

    [Parameter]
    public string? searchCity { get; set; }
    public string? startDate;
    public string? endDate;
    public string key = "7BNRT6CGQ67M4HMLNNL2Q7FXE";
    private async void SearchCity()
    {
        // byt om på disse 2 calls
        var city = await Http.GetFromJsonAsync<SRoot>("https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/Odense,DK/2022-11-20/2022-11-22?key=7BNRT6CGQ67M4HMLNNL2Q7FXE");
    if (city != null)
        {
            forecasts = await Http.GetFromJsonAsync<SRoot>("https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/" + searchCity + ",DK/" + startDate + "/" + endDate + "?key=" + key);
        }

    }
    //[Parameter]
    //Root myDeserializedClass = JsonConvert.DeserializeObject<Root>(myJsonResponse);



    // Root myDeserializedClass = JsonConvert.DeserializeObject<Root>(myJsonResponse);
    // Root myDeserializedClass = JsonConvert.DeserializeObject<Root>(myJsonResponse);
    public class _06119099999
    {
        public double distance { get; set; }
        public double latitude { get; set; }
        public double longitude { get; set; }
        public int useCount { get; set; }
        public string id { get; set; }
        public string name { get; set; }
        public int quality { get; set; }
        public double contribution { get; set; }
    }

    public class _06120099999
    {
        public double distance { get; set; }
        public double latitude { get; set; }
        public double longitude { get; set; }
        public int useCount { get; set; }
        public string id { get; set; }
        public string name { get; set; }
        public int quality { get; set; }
        public double contribution { get; set; }
    }

    public class _06126099999
    {
        public double distance { get; set; }
        public double latitude { get; set; }
        public double longitude { get; set; }
        public int useCount { get; set; }
        public string id { get; set; }
        public string name { get; set; }
        public int quality { get; set; }
        public double contribution { get; set; }
    }

    public class _06135099999
    {
        public double distance { get; set; }
        public double latitude { get; set; }
        public double longitude { get; set; }
        public int useCount { get; set; }
        public string id { get; set; }
        public string name { get; set; }
        public int quality { get; set; }
        public double contribution { get; set; }
    }

    public class _06136099999
    {
        public double distance { get; set; }
        public double latitude { get; set; }
        public double longitude { get; set; }
        public int useCount { get; set; }
        public string id { get; set; }
        public string name { get; set; }
        public int quality { get; set; }
        public double contribution { get; set; }
    }

    public class _06159099999
    {
        public double distance { get; set; }
        public double latitude { get; set; }
        public double longitude { get; set; }
        public int useCount { get; set; }
        public string id { get; set; }
        public string name { get; set; }
        public int quality { get; set; }
        public double contribution { get; set; }
    }

    public class D8529
    {
        public double distance { get; set; }
        public double latitude { get; set; }
        public double longitude { get; set; }
        public int useCount { get; set; }
        public string id { get; set; }
        public string name { get; set; }
        public int quality { get; set; }
        public double contribution { get; set; }
    }

    public class Day
    {
        public string datetime { get; set; }
        public int datetimeEpoch { get; set; }
        public double tempmax { get; set; }
        public double tempmin { get; set; }
        public double temp { get; set; }
        public double feelslikemax { get; set; }
        public double feelslikemin { get; set; }
        public double feelslike { get; set; }
        public double dew { get; set; }
        public double humidity { get; set; }
        public double precip { get; set; }
        public double precipprob { get; set; }
        public double precipcover { get; set; }
        public List<string> preciptype { get; set; }
        public double snow { get; set; }
        public double snowdepth { get; set; }
        public double? windgust { get; set; }
        public double windspeed { get; set; }
        public double winddir { get; set; }
        public double pressure { get; set; }
        public double cloudcover { get; set; }
        public double visibility { get; set; }
        public double solarradiation { get; set; }
        public double solarenergy { get; set; }
        public double uvindex { get; set; }
        public string sunrise { get; set; }
        public int sunriseEpoch { get; set; }
        public string sunset { get; set; }
        public int sunsetEpoch { get; set; }
        public double moonphase { get; set; }
        public string conditions { get; set; }
        public string description { get; set; }
        public string icon { get; set; }
        public List<string> stations { get; set; }
        public string source { get; set; }
        public List<Hour> hours { get; set; }
        public double? tzoffset { get; set; }
    }

    public class Hour
    {
        public string datetime { get; set; }
        public int datetimeEpoch { get; set; }
        public double temp { get; set; }
        public double feelslike { get; set; }
        public double humidity { get; set; }
        public double dew { get; set; }
        public double precip { get; set; }
        public double precipprob { get; set; }
        public double? snow { get; set; }
        public double? snowdepth { get; set; }
        public List<string> preciptype { get; set; }
        public double? windgust { get; set; }
        public double windspeed { get; set; }
        public double winddir { get; set; }
        public double? pressure { get; set; }
        public double? visibility { get; set; }
        public double cloudcover { get; set; }
        public double solarradiation { get; set; }
        public double? solarenergy { get; set; }
        public double uvindex { get; set; }
        public string conditions { get; set; }
        public string icon { get; set; }
        public List<string> stations { get; set; }
        public string source { get; set; }
        public double? tzoffset { get; set; }
    }

    public class SRoot
    {
        public int queryCost { get; set; }
        public double latitude { get; set; }
        public double longitude { get; set; }
        public string resolvedAddress { get; set; }
        public string address { get; set; }
        public string timezone { get; set; }
        public double tzoffset { get; set; }
        public List<Day> days { get; set; }
        public Stations stations { get; set; }
    }

    public class Stations
    {
        [JsonProperty("06119099999")]
        public _06119099999 _06119099999 { get; set; }
        public D8529 D8529 { get; set; }

        [JsonProperty("06126099999")]
        public _06126099999 _06126099999 { get; set; }

        [JsonProperty("06135099999")]
        public _06135099999 _06135099999 { get; set; }

        [JsonProperty("06120099999")]
        public _06120099999 _06120099999 { get; set; }

        [JsonProperty("06159099999")]
        public _06159099999 _06159099999 { get; set; }

        [JsonProperty("06136099999")]
        public _06136099999 _06136099999 { get; set; }
    }

    // Root myDeserializedClass = JsonConvert.DeserializeObject<Root>(myJsonResponse);
    
}